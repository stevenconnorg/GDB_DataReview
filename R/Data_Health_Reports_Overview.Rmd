---
output:
  bookdown::pdf_document2:
    latex_engine: xelatex
    toc: true
    toc_depth: 3
    number_sections: true
    fig_caption: true
    keep_md: true
    documentclass: report
    self_contained: true
author: "Air Force Civic Engineering Center (AFCEC) Geospatial Integration Center (GIO)"
title: "Data Health Report Installation Overview"
date: "`r format(Sys.time(), '%d %B, %Y')`"
link-citations: true
header-includes:
  - \usepackage {hyperref}
  - \hypersetup{linktocpage}
  - \hypersetup {colorlinks = true,linkcolor = blue, urlcolor = blue}
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage[table]{xcolor}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage[normalem]{ulem}
---

```{r}
install.packages("RODBC")
#library(RODBC)
setwd("C:/Users/stevenconnorg/Documents/knight-federal-solutions/DHRs/DHRs")
library(xlsx)
data = read.xlsx("C:/Users/stevenconnorg/Documents/knight-federal-solutions/DHRs/DHRs/DHR_Dataframe.xlsx", sheetName = "Sheet1")

dataCounts = read.xlsx("C:/Users/stevenconnorg/Documents/knight-federal-solutions/DHRs/DHRs/DHR_Dataframe.xlsx", sheetName = "Sheet1")

df = merge(data, dataCounts, 
      by.x = "Installation", by.y = "Installation",
      sort = TRUE, suffixes = c("_Pct","_Count"))


str(df)
# convert columns to numeric except 1st
for (i in 2:ncol(df)){
  df[,i]<-as.numeric(df[,i])
}
str(df)
df= df[ , order(names(df))]
 
row.names(df)<-df$Installation
drops <- c("Installation")
df = df[ , !(names(df) %in% drops)]
write.xlsx(df, "C:/Users/stevenconnorg/Documents/knight-federal-solutions/DHRs/DHRs/DHR_Dataframe_Full.xlsx", sheetName="Sheet1",  col.names=TRUE, row.names=TRUE, append=FALSE, showNA=TRUE)

```


```{r cLoadlibs, echo=FALSE,message=FALSE,error=FALSE,warning=FALSE}
suppressWarnings(suppressPackageStartupMessages(library(ggplot2)))
suppressWarnings(suppressPackageStartupMessages(library(dplyr)))
suppressWarnings(suppressPackageStartupMessages(library(leaflet)))
suppressWarnings(suppressPackageStartupMessages(library(DT)))
suppressWarnings(suppressPackageStartupMessages(library(stringr)))
library(knitr)
library(markdown)
library(rmarkdown)
library(sf)
library(devtools)
library(Rcpp)
library(kableExtra)
library(dplyr)
library(purrr)
library(anchors)
library(bookdown)
library(tinytex)

```

```{r knitr_options, echo=FALSE}
opts_knit$set(root.dir = normalizePath("../"))
options(knitr.table.format = "latex")
```

# Introduction
This report provides a high-level overview of geodatabase health for Air Force (AF) installations reviewed at the Air Force Civil Engineering Center's (AFCEC) Geospatial Integration Office (GIO). The AFCEC GIO compared AF installations' geodatabases for adhereance to the current Air Force Data Model (GeoBase 3.1.0.1) developed under the AF GeoBase mission. The GeoBase 3.1.0.1 data model is based upon the Spatial Data Standards for Facilities, Infrastructure, and Environment (SDSFIE) SDSFIE-V 3.1 Gold model, which complies with the Department of Defense Instruction (DoDI) 8130.01, Installation Geospatial Information and Service (IGI&S), but allows some greater flexibility within the program to aid the AF mission. This report helps provides an overview of how AF installations might better standardize their geodatabase schemas to better adhere to the GeoBase 3.1.0.1 data model.

# 

```{r}
hist(df$Determinate.Values_Pct)
colnames(df)
p <-ggplot(df, aes(x = Installation, y = Determinate.Values_Pct,fill = ind)) )
p +geom_bar(stat = "identity")+ theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  coord_flip()
```

```{r setup, include=FALSE}
rmarkdown::render(input = paste0(getwd(),"/R/Installation_Reports.Rmd"),
                        output_file = paste0(installationName,"_Missing_Data_Report_",compName),
                        output_dir = reportDir,
                        clean= FALSE,
                        pdf_document2(toc = TRUE, number_sections = TRUE, fig_caption = TRUE,  toc_unnumbered = FALSE, toc_appendix = TRUE, toc_bib = TRUE, quote_footer = NULL, highlight_bw = FALSE)
                        )

```
                        



## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
